# DDD åˆ†å±‚æ¶æ„è¯´æ˜

## ğŸ“¦ æ­£ç¡®çš„æ¨¡å—å’ŒåŒ…ç»“æ„

### âœ… å½“å‰æ­£ç¡®çš„ç»“æ„

```
rbac-ddd-system/
â”‚
â”œâ”€â”€ rbac-core/                                    # æ ¸å¿ƒé¢†åŸŸæ¨¡å—
â”‚   â””â”€â”€ src/main/java/com/example/rbac/core/
â”‚       â””â”€â”€ domain/                               â† åªåŒ…å«domainï¼
â”‚           â”œâ”€â”€ model/                            # èšåˆæ ¹ã€å®ä½“ã€å€¼å¯¹è±¡
â”‚           â”‚   â”œâ”€â”€ user/                         # ç”¨æˆ·èšåˆ
â”‚           â”‚   â”œâ”€â”€ role/                         # è§’è‰²èšåˆ
â”‚           â”‚   â”œâ”€â”€ permission/                   # æƒé™èšåˆ
â”‚           â”‚   â””â”€â”€ tenant/                       # ç§Ÿæˆ·èšåˆ
â”‚           â”œâ”€â”€ service/                          # é¢†åŸŸæœåŠ¡
â”‚           â”‚   â”œâ”€â”€ PermissionCheckService.java
â”‚           â”‚   â”œâ”€â”€ PermissionCheckServiceImpl.java
â”‚           â”‚   â””â”€â”€ DomainEventPublisher.java
â”‚           â”œâ”€â”€ repository/                       # ä»“å‚¨æ¥å£
â”‚           â”‚   â”œâ”€â”€ UserRepository.java
â”‚           â”‚   â”œâ”€â”€ RoleRepository.java
â”‚           â”‚   â”œâ”€â”€ PermissionRepository.java
â”‚           â”‚   â””â”€â”€ TenantRepository.java
â”‚           â””â”€â”€ event/                            # é¢†åŸŸäº‹ä»¶
â”‚               â”œâ”€â”€ UserRoleAssignedEvent.java
â”‚               â”œâ”€â”€ RolePermissionAddedEvent.java
â”‚               â””â”€â”€ ...
â”‚
â”œâ”€â”€ rbac-application/                             # åº”ç”¨æœåŠ¡æ¨¡å—
â”‚   â””â”€â”€ src/main/java/com/example/rbac/
â”‚       â””â”€â”€ application/                          â† åº”ç”¨å±‚åœ¨è¿™é‡Œï¼
â”‚           â”œâ”€â”€ service/                          # åº”ç”¨æœåŠ¡
â”‚           â”‚   â”œâ”€â”€ UserApplicationService.java
â”‚           â”‚   â”œâ”€â”€ RoleApplicationService.java
â”‚           â”‚   â”œâ”€â”€ PermissionApplicationService.java
â”‚           â”‚   â”œâ”€â”€ BusinessException.java
â”‚           â”‚   â””â”€â”€ DomainEventPublisher.java (æ¥å£)
â”‚           â”œâ”€â”€ command/                          # å‘½ä»¤å¯¹è±¡
â”‚           â”‚   â”œâ”€â”€ CreateUserCommand.java
â”‚           â”‚   â”œâ”€â”€ CreateRoleCommand.java
â”‚           â”‚   â”œâ”€â”€ CreatePermissionCommand.java
â”‚           â”‚   â””â”€â”€ AssignRolesCommand.java
â”‚           â”œâ”€â”€ dto/                              # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚           â”‚   â”œâ”€â”€ UserDTO.java
â”‚           â”‚   â”œâ”€â”€ RoleDTO.java
â”‚           â”‚   â”œâ”€â”€ PermissionDTO.java
â”‚           â”‚   â””â”€â”€ UserPermissionsDTO.java
â”‚           â””â”€â”€ assembler/                        # æ•°æ®ç»„è£…å™¨
â”‚               â”œâ”€â”€ UserAssembler.java
â”‚               â”œâ”€â”€ RoleAssembler.java
â”‚               â””â”€â”€ PermissionAssembler.java
â”‚
â”œâ”€â”€ rbac-infrastructure/                          # åŸºç¡€è®¾æ–½æ¨¡å—
â”‚   â””â”€â”€ src/main/java/com/example/rbac/
â”‚       â””â”€â”€ infrastructure/
â”‚           â”œâ”€â”€ persistence/                      # æŒä¹…åŒ–å®ç°
â”‚           â”‚   â”œâ”€â”€ jpa/                          # JPAå®ä½“
â”‚           â”‚   â”œâ”€â”€ mapper/                       # å¯¹è±¡æ˜ å°„
â”‚           â”‚   â””â”€â”€ *RepositoryImpl.java          # ä»“å‚¨å®ç°
â”‚           â”œâ”€â”€ event/                            # äº‹ä»¶å‘å¸ƒå®ç°
â”‚           â”‚   â””â”€â”€ DomainEventPublisherImpl.java
â”‚           â””â”€â”€ cache/                            # ç¼“å­˜å®ç°
â”‚
â””â”€â”€ rbac-interface/                               # Webæ¥å£æ¨¡å—
    â””â”€â”€ src/main/java/com/example/rbac/
        â”œâ”€â”€ RbacApplication.java                  # å¯åŠ¨ç±»
        â”œâ”€â”€ web/                                  # Webå±‚
        â”‚   â”œâ”€â”€ controller/                       # RESTæ§åˆ¶å™¨
        â”‚   â”œâ”€â”€ security/                         # å®‰å…¨è®¤è¯
        â”‚   â”œâ”€â”€ aop/                              # AOPåˆ‡é¢
        â”‚   â””â”€â”€ config/                           # é…ç½®ç±»
        â””â”€â”€ test/                                 # æµ‹è¯•æ•°æ®
```

---

## ğŸ¯ DDDå››å±‚æ¶æ„èŒè´£

### 1ï¸âƒ£ é¢†åŸŸå±‚ï¼ˆDomain Layerï¼‰- `rbac-core`

**èŒè´£ï¼š** æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œç³»ç»Ÿçš„å¿ƒè„

**åŒ…å«å†…å®¹ï¼š**
- âœ… èšåˆæ ¹ï¼ˆAggregate Rootï¼‰ï¼šUser, Role, Permission, Tenant
- âœ… å®ä½“ï¼ˆEntityï¼‰ï¼šå…·æœ‰å”¯ä¸€æ ‡è¯†çš„å¯¹è±¡
- âœ… å€¼å¯¹è±¡ï¼ˆValue Objectï¼‰ï¼šæ— æ ‡è¯†çš„ä¸å¯å˜å¯¹è±¡
- âœ… é¢†åŸŸæœåŠ¡ï¼ˆDomain Serviceï¼‰ï¼šè·¨èšåˆçš„ä¸šåŠ¡é€»è¾‘
- âœ… é¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventï¼‰ï¼šé¢†åŸŸå†…å‘ç”Ÿçš„é‡è¦äº‹ä»¶
- âœ… ä»“å‚¨æ¥å£ï¼ˆRepository Interfaceï¼‰ï¼šæ•°æ®è®¿é—®æŠ½è±¡

**ä¸åŒ…å«ï¼š**
- âŒ åº”ç”¨æœåŠ¡ï¼ˆApplication Serviceï¼‰
- âŒ DTOï¼ˆData Transfer Objectï¼‰
- âŒ å‘½ä»¤å¯¹è±¡ï¼ˆCommandï¼‰
- âŒ ä»»ä½•åŸºç¡€è®¾æ–½å®ç°

**ä¾èµ–å…³ç³»ï¼š**
- ä¸ä¾èµ–ä»»ä½•å…¶ä»–å±‚
- åªä¾èµ–JDKå’Œå°‘é‡åŸºç¡€åº“ï¼ˆå¦‚Lombokï¼‰

---

### 2ï¸âƒ£ åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰- `rbac-application`

**èŒè´£ï¼š** åè°ƒé¢†åŸŸå¯¹è±¡å®Œæˆç”¨ä¾‹ï¼Œç¼–æ’ä¸šåŠ¡æµç¨‹

**åŒ…å«å†…å®¹ï¼š**
- âœ… åº”ç”¨æœåŠ¡ï¼ˆApplication Serviceï¼‰ï¼šç”¨ä¾‹çš„å®ç°
- âœ… å‘½ä»¤å¯¹è±¡ï¼ˆCommandï¼‰ï¼šå°è£…æ“ä½œè¯·æ±‚
- âœ… æŸ¥è¯¢å¯¹è±¡ï¼ˆQueryï¼‰ï¼šå°è£…æŸ¥è¯¢è¯·æ±‚
- âœ… DTOï¼ˆData Transfer Objectï¼‰ï¼šæ•°æ®ä¼ è¾“å¯¹è±¡
- âœ… ç»„è£…å™¨ï¼ˆAssemblerï¼‰ï¼šé¢†åŸŸå¯¹è±¡ä¸DTOè½¬æ¢

**èŒè´£è¯´æ˜ï¼š**
```java
// åº”ç”¨æœåŠ¡çš„å…¸å‹èŒè´£
@Service
public class UserApplicationService {
    
    // 1. åè°ƒé¢†åŸŸå¯¹è±¡
    public UserDTO createUser(CreateUserCommand command) {
        // 2. è°ƒç”¨é¢†åŸŸæœåŠ¡
        User user = new User(...);
        
        // 3. è°ƒç”¨ä»“å‚¨
        userRepository.save(user);
        
        // 4. å‘å¸ƒé¢†åŸŸäº‹ä»¶
        domainEventPublisher.publish(user.getDomainEvents());
        
        // 5. è½¬æ¢ä¸ºDTOè¿”å›
        return UserAssembler.toDTO(user);
    }
}
```

**ä¾èµ–å…³ç³»ï¼š**
- ä¾èµ–é¢†åŸŸå±‚ï¼ˆ`rbac-core`ï¼‰
- ä¸ä¾èµ–åŸºç¡€è®¾æ–½å±‚å’Œè¡¨ç°å±‚

---

### 3ï¸âƒ£ åŸºç¡€è®¾æ–½å±‚ï¼ˆInfrastructure Layerï¼‰- `rbac-infrastructure`

**èŒè´£ï¼š** æä¾›æŠ€æœ¯å®ç°ï¼Œæ”¯æ’‘ä¸Šå±‚ä¸šåŠ¡

**åŒ…å«å†…å®¹ï¼š**
- âœ… ä»“å‚¨å®ç°ï¼ˆRepository Implementationï¼‰
- âœ… JPAå®ä½“æ˜ å°„ï¼ˆEntity Mappingï¼‰
- âœ… å¯¹è±¡æ˜ å°„å™¨ï¼ˆMapperï¼‰
- âœ… ç¼“å­˜å®ç°
- âœ… æ¶ˆæ¯é˜Ÿåˆ—å®ç°
- âœ… å¤–éƒ¨æœåŠ¡è°ƒç”¨

**ä¾èµ–å…³ç³»ï¼š**
- ä¾èµ–é¢†åŸŸå±‚ï¼ˆå®ç°ä»“å‚¨æ¥å£ï¼‰
- ä¸ä¾èµ–åº”ç”¨å±‚å’Œè¡¨ç°å±‚

---

### 4ï¸âƒ£ è¡¨ç°å±‚ï¼ˆPresentation Layerï¼‰- `rbac-interface/web`

**èŒè´£ï¼š** å¯¹å¤–æä¾›æ¥å£ï¼Œå¤„ç†ç”¨æˆ·è¯·æ±‚

**åŒ…å«å†…å®¹ï¼š**
- âœ… RESTæ§åˆ¶å™¨ï¼ˆControllerï¼‰
- âœ… å®‰å…¨é…ç½®ï¼ˆSecurityï¼‰
- âœ… AOPåˆ‡é¢ï¼ˆAspectï¼‰
- âœ… å…¨å±€é…ç½®ï¼ˆConfigurationï¼‰
- âœ… å¼‚å¸¸å¤„ç†ï¼ˆException Handlerï¼‰

**ä¾èµ–å…³ç³»ï¼š**
- ä¾èµ–åº”ç”¨å±‚ï¼ˆè°ƒç”¨åº”ç”¨æœåŠ¡ï¼‰
- ä¾èµ–åŸºç¡€è®¾æ–½å±‚ï¼ˆSpringé…ç½®ï¼‰

---

## âš ï¸ å¸¸è§é”™è¯¯

### âŒ é”™è¯¯1ï¼šåœ¨ `rbac-core` ä¸­æ”¾ç½®åº”ç”¨å±‚ä»£ç 

```
âŒ é”™è¯¯ç¤ºä¾‹ï¼š
rbac-core/
â””â”€â”€ src/main/java/com/example/rbac/core/
    â”œâ”€â”€ domain/          â† æ­£ç¡®
    â””â”€â”€ application/     â† é”™è¯¯ï¼åº”ç”¨å±‚ä¸åº”è¯¥åœ¨coreæ¨¡å—
        â”œâ”€â”€ service/
        â”œâ”€â”€ command/
        â””â”€â”€ dto/
```

**ä¸ºä»€ä¹ˆé”™è¯¯ï¼Ÿ**
- è¿åäº†DDDåˆ†å±‚åŸåˆ™
- é¢†åŸŸå±‚åº”è¯¥ä¿æŒçº¯å‡€ï¼Œä¸åŒ…å«åº”ç”¨é€»è¾‘
- åº”ç”¨å±‚ä¾èµ–é¢†åŸŸå±‚ï¼Œè€Œä¸æ˜¯åœ¨åŒä¸€æ¨¡å—

### âŒ é”™è¯¯2ï¼šå¾ªç¯ä¾èµ–

```
âŒ é”™è¯¯ç¤ºä¾‹ï¼š
rbac-core ä¾èµ– rbac-application
rbac-application ä¾èµ– rbac-core
```

**æ­£ç¡®çš„ä¾èµ–æ–¹å‘ï¼š**
```
âœ… æ­£ç¡®ï¼š
rbac-interface â†’ rbac-application â†’ rbac-core
                      â†“
              rbac-infrastructure â†’ rbac-core
```

---

## ğŸ“Š ä¾èµ–å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         rbac-interface (web)            â”‚  è¡¨ç°å±‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Controller, Security, AOP, Configâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ ä¾èµ–
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        rbac-application                 â”‚  åº”ç”¨å±‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Service, Command, DTO, Assembler â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ ä¾èµ–
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           rbac-core (domain)            â”‚  é¢†åŸŸå±‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Model, Service, Repository, Eventâ”‚   â”‚  â† æ ¸å¿ƒï¼
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–²
                 â”‚ å®ç°
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       rbac-infrastructure               â”‚  åŸºç¡€è®¾æ–½å±‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ JPA, Mapper, Cache, Event Impl   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… éªŒè¯æ¸…å•

æ£€æŸ¥æ‚¨çš„é¡¹ç›®æ˜¯å¦ç¬¦åˆDDDè§„èŒƒï¼š

- [x] `rbac-core` åªåŒ…å« `domain` åŒ…
- [x] `rbac-application` åŒ…å«åº”ç”¨æœåŠ¡ã€å‘½ä»¤ã€DTO
- [x] `rbac-infrastructure` å®ç°ä»“å‚¨æ¥å£
- [x] `rbac-interface` æä¾›REST API
- [x] ä¾èµ–æ–¹å‘æ­£ç¡®ï¼ˆå•å‘ä¾èµ–ï¼‰
- [x] æ²¡æœ‰å¾ªç¯ä¾èµ–
- [x] é¢†åŸŸå±‚ä¸ä¾èµ–ä»»ä½•æ¡†æ¶

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Domain-Driven Design - Eric Evans](https://www.domainlanguage.com/ddd/)
- [Implementing Domain-Driven Design - Vaughn Vernon](https://vaughnvernon.com/)
- [Clean Architecture - Robert C. Martin](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)

---

## æ€»ç»“

âœ… **å·²åˆ é™¤** `rbac-core/src/main/java/com/example/rbac/core/application/` ç©ºç›®å½•

âœ… **æ­£ç¡®ç»“æ„ï¼š**
- é¢†åŸŸå±‚åœ¨ `rbac-core/domain`
- åº”ç”¨å±‚åœ¨ `rbac-application/application`
- åŸºç¡€è®¾æ–½å±‚åœ¨ `rbac-infrastructure/infrastructure`
- è¡¨ç°å±‚åœ¨ `rbac-interface/web`

è¿™æ‰æ˜¯ç¬¦åˆDDDè§„èŒƒçš„æ­£ç¡®æ¶æ„ï¼ğŸ¯

